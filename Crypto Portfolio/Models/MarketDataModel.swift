//
//  MarketDataModel.swift
//  TrackMyCrypto
//
//  Created by Marc Boanas on 24/10/2022.
//

import Foundation

/* JSON Data
 
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 {
 "data": {
 "active_cryptocurrencies": 13258,
 "upcoming_icos": 0,
 "ongoing_icos": 49,
 "ended_icos": 3376,
 "markets": 599,
 "total_market_cap": {
 "btc": 50131435.12313238,
 "eth": 718928758.1470625,
 "ltc": 18455511954.799393,
 "bch": 8959264238.612648,
 "bnb": 3548638129.1330256,
 "eos": 906554965688.3828,
 "xrp": 2119232551654.5469,
 "xlm": 8733568373440.272,
 "link": 140195970087.78598,
 "dot": 164865678627.28687,
 "yfi": 127536436.50961515,
 "usd": 969638647763.9716,
 "aed": 3561473056850.594,
 "ars": 149980235699410.94,
 "aud": 1536683328976.3452,
 "bdt": 98140402009905.05,
 "bhd": 365449049233.0591,
 "bmd": 969638647763.9716,
 "brl": 5145873273322.051,
 "cad": 1329423068016.793,
 "chf": 970230127339.109,
 "clp": 955708172201215.4,
 "cny": 7042485498709.742,
 "czk": 24031038457219.758,
 "dkk": 7304797963534.718,
 "eur": 981962754977.0519,
 "gbp": 859608902208.9567,
 "hkd": 7611808830744.33,
 "huf": 406404641589120.6,
 "idr": 1.5124326663957688e+16,
 "ils": 3448102906154.0303,
 "inr": 80239294970102.16,
 "jpy": 144457735382524.22,
 "krw": 1.401020713553666e+15,
 "kwd": 300950625661.0952,
 "lkr": 354132499356702.44,
 "mmk": 2026369250808322.2,
 "mxn": 19332267503658.99,
 "myr": 4594147913105.702,
 "ngn": 425091575787146.8,
 "nok": 10206416406363.6,
 "nzd": 1703212948897.918,
 "php": 57048205021869.68,
 "pkr": 212872476122681.44,
 "pln": 4699505939655.793,
 "rub": 60117496288585.78,
 "sar": 3643901068658.362,
 "sek": 10820915202997.496,
 "sgd": 1379131593294.4158,
 "thb": 37069285504016.695,
 "try": 18012395376322.676,
 "twd": 31357144230039.105,
 "uah": 35636572648685.46,
 "vef": 97089917800.60646,
 "vnd": 2.4100212055588788e+16,
 "zar": 17860549964082.844,
 "xdr": 690167457428.145,
 "xag": 50370963008.99928,
 "xau": 587727073.5691752,
 "bits": 50131435123132.375,
 "sats": 5.013143512313238e+15
 },
 "total_volume": {
 "btc": 3286322.875410704,
 "eth": 47128753.004701056,
 "ltc": 1209835125.7150946,
 "bch": 587316819.1152735,
 "bnb": 232627903.66324997,
 "eos": 59428426779.351814,
 "xrp": 138924457193.59988,
 "xlm": 572521521857.5787,
 "link": 9190425576.45212,
 "dot": 10807626985.187908,
 "yfi": 8360540.800806119,
 "usd": 63563823002.51882,
 "aed": 233469286250.02188,
 "ars": 9831824647107.096,
 "aud": 100735946694.39203,
 "bdt": 6433509181115.208,
 "bhd": 23956696379.065342,
 "bmd": 63563823002.51882,
 "brl": 337333272238.1908,
 "cad": 87149179527.60342,
 "chf": 63602596934.55045,
 "clp": 62650622724194.63,
 "cny": 461664046467.2953,
 "czk": 1575333943819.1033,
 "dkk": 478859713248.87335,
 "eur": 64371719192.88085,
 "gbp": 56350918187.30811,
 "hkd": 498985545143.22235,
 "huf": 26641504817226.625,
 "idr": 991462154810990.6,
 "ils": 226037404064.56738,
 "inr": 5260017590148.682,
 "jpy": 9469801914738.254,
 "krw": 91842701262527.8,
 "kwd": 19728558000.583797,
 "lkr": 23214849738568.184,
 "mmk": 132836883815588.33,
 "mxn": 1267310077495.0212,
 "myr": 301165393385.9345,
 "ngn": 27866510627960.56,
 "nok": 669072800924.5154,
 "nzd": 111652651912.13644,
 "php": 3739745744441.713,
 "pkr": 13954671078316.73,
 "pln": 308072047701.91925,
 "rub": 3940950479082.415,
 "sar": 238872783279.64304,
 "sek": 709355738114.1289,
 "sgd": 90407778913.82773,
 "thb": 2430044953386.2983,
 "try": 1180787001623.993,
 "twd": 2055590472078.458,
 "uah": 2336124701177.173,
 "vef": 6364645597.2422085,
 "vnd": 1579868559238276.2,
 "zar": 1170832906941.7988,
 "xdr": 45243330809.0869,
 "xag": 3302024918.822981,
 "xau": 38527940.036516674,
 "bits": 3286322875410.704,
 "sats": 328632287541070.4
 },
 "market_cap_percentage": {
 "btc": 38.27420629980696,
 "eth": 16.76330602763554,
 "usdt": 7.0526777962183544,
 "bnb": 4.601123850716634,
 "usdc": 4.51654623985496,
 "xrp": 2.353877819936009,
 "busd": 2.242191129290267,
 "ada": 1.2998087356411947,
 "sol": 1.0498048940491338,
 "doge": 0.8370931903198675
 },
 "market_cap_change_percentage_24h_usd": -0.027695519806051783,
 "updated_at": 1666646485
 }
 }
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "gbp" }) {
            return "£" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "gbp" }) {
            return "£" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentageString()
        }
        return ""
    }
}
